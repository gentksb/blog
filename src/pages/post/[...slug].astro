---
import { getEntry } from "astro:content"
import { type CollectionEntry, getCollection } from "astro:content"
import BlogPost from "@layouts/BlogPost.astro"
import {
  MdxH2,
  MdxH3,
  MdxH4,
  MdxParagraph,
  MdxBlockQuote,
  MdxA,
  MdxTable,
  MdxStrong
} from "@components/mdx/mdxReplacer"
import MdxPicture from "@components/mdx/MdxPicture.astro"

// SSRでは記事単体をgetEntryで取得する
// 1. Get the slug from the incoming server request
const { slug } = Astro.params
if (slug === undefined) {
  throw new Error("Slug is required")
}
// 2. Query for the entry directly using the request slug
const entry = await getEntry("post", slug)
// 3. Redirect if the entry does not exist
if (entry === undefined) {
  return Astro.redirect("/404")
}
// 4. (Optional) Render the entry to HTML in the template
const { Content, remarkPluginFrontmatter } = await entry.render()

type Props = CollectionEntry<"post">
---

<BlogPost {...entry} description={remarkPluginFrontmatter.excerpt}>
  <Content
    components={{
      h2: MdxH2,
      h3: MdxH3,
      h4: MdxH4,
      p: MdxParagraph,
      blockquote: MdxBlockQuote,
      a: MdxA,
      table: MdxTable,
      strong: MdxStrong,
      img: MdxPicture
    }}
  />
</BlogPost>
